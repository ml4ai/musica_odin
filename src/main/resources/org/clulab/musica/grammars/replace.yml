
vars: org/clulab/musica/grammars/triggers.yml


rules:

  # works for both active and passive
  - name: replace-0-syntax-that-is-in
    label: ${label}
    priority: ${rulepriority}
    example: "Replace the quarter note that is in the first measure with a half rest"
    pattern:
      trigger = [word=/(?i)^(${replace_triggers})/]
      sourceEntity:EntityMusic = >/dobj|nsubjpass/
      sourceLocation:Location = >/dobj|nsubjpass/ <nsubj (>/nmod_in|nmod_at/)?
      destEntity:EntityMusic? = (>dobj <nsubj (>/nmod_in|nmod_at/)?)? >/nmod_with|nmod_agent/

  - name: replace-1
    label: ${label}
    priority: ${rulepriority}
    example: "replace the A in measure 1 with a B"
    type: token
    pattern: |
      (@location:Location [tag=/,/]?)? (?<trigger>[word=/(?i)^(${replace_triggers})/])
      (@sourceEntity:EntityMusic|@everything:Everything) @location:Location? (with|by)
      @destEntity:EntityMusic @location:Location?

  - name: replace-2-passive
    label: ${label}
    priority: ${rulepriority}
    example: "The A in measure 1 should be replaced with a B"
    type: token
    pattern: |
      (@location:Location [tag=/,/]?)? (@sourceEntity:EntityMusic|@everything:Everything) @location:Location?
      [word=/^(${modals})/]? to? [word=/^(${aux_be})/]? (?<trigger>[word=/(?i)^(${replace_triggers})/]) (with|by)
      @destEntity:EntityMusic @location:Location?

  - name: replace-3-interveningverb
    label: ${label}
    priority: ${rulepriority}
    example: "Take the C quarter note in the first measure and replace it with a quarter rest"
    type: token
    pattern: |
      (@location:Location [tag=/,/])? [tag=/^VB/] (@everything:Everything|@sourceEntity:EntityMusic)
      @location:Location? and (?<trigger>[word=/(?i)^(${replace_triggers})/]) []? (with|by) @destEntity:EntityMusic
      @location:Location?

  - name: replace-4-passive-interveningverb
    label: ${label}
    priority: ${rulepriority}
    example: "The C quarter note should be taken from the first measure and replaced with a quarter rest"
    type: token
    pattern: |
      (@location:Location [tag=/,/])? (@everything:Everything|@sourceEntity:EntityMusic)
      @location:Location? [word=/^(${modals})/]? to? [word=/^(${aux_be})/] [tag=/^VB/]
      @location:Location? and (?<trigger>[word=/(?i)^(${replace_triggers})/]) (with|by) @destEntity:EntityMusic
      @location:Location?

#  - name: replace-3-syntax
#    label: ${label}
#    priority: ${rulepriority}
#    example: "replace the first two quarter notes with a half note"
#    pattern: |
#      trigger = [word=/(?i)^(${replace_triggers})/]
#      sourceEntity:EntityMusic = >dobj
#      destEntity:EntityMusic? = >dobj? >/(nmod_in|nmod_at)/? >/(nmod_with|nmod_by)/
#      location:Location? = >/(dobj|nmod_with)/? >/(nmod_in|nmod_at)/
#
#  - name: replace-4-syntax-passive
#    label: ${label}
#    priority: ${rulepriority}
#    example: "the first two quarter notes should be replaced with a half note"
#    pattern: |
#      trigger = [word=/(?i)^(${replace_triggers})/]
#      sourceEntity:EntityMusic = >nsubjpass
#      destEntity:EntityMusic? = >nsubjpass? >/(nmod_in|nmod_at)/? >/(nmod_with|nmod_by)/
#      location:Location? = >/(nsubjpass|nmod_with)/? >/(nmod_in|nmod_at)/

#  - name: replace-5-syntax-conjunction
#    label: ${label}
#    priority: ${rulepriority}
#    example: "replace the first note with a whole note and the last note with a B"
#    pattern: |
#      trigger = [word=/(?i)^(${replace_triggers})/]
#      sourceEntity:EntityMusic = >/(nmod_with|nmod_by)/ >conj_and
#      destEntity:EntityMusic? =  >/(nmod_with|nmod_by)/ >conj_and >/(nmod_with|nmod_by)/
##      location:Location? = >/(dobj|nmod_with)/? >/(nmod_in|nmod_at)/
