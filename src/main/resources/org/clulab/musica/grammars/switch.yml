
vars: org/clulab/musica/grammars/triggers.yml


rules:

  # works for both active and passive
  # todo: fix
  # currently works with 'that is' in both sides of coordination, first side only
  # does not work with 'that is' in second half of coordination only
  - name: switch-0-syntax-that-is-in
    label: ${label}
    priority: ${rulepriority}
    example: "Switch the quarter note that is in the first measure and the half note that is in the second measure"
    pattern:
      trigger = [word=/(?i)^(${switch_triggers})/]
      sourceEntity:EntityMusic = >/dobj|nsubjpass/
      sourceLocation:Location = >/dobj|nsubjpass/ <nsubj (>/nmod_in|nmod_at/)?
      destEntity:EntityMusic? = (>dobj <nsubj (>/nmod_in|nmod_at/)?)? >/conj_and|nmod_with/
      destLocation:Location? = (>dobj <nsubj (>/nmod_in|nmod_at/)?)? >/conj_and|nmod_with/ (<nsubj|>nmod_in)

  - name: switch-1
    label: ${label}
    priority: ${rulepriority}
    example: "Switch the D and the C in measure 1"
    type: token
    pattern: |
      (@location:Location [tag=/,/])? (?<trigger>[word=/(?i)^(${switch_triggers})/]) @sourceEntity:EntityMusic
      and @destEntity:EntityMusic @location:Location?

  # todo: how do we represent this in terms of source and destination entities?
  - name: switch-2
    label: ${label}
    priority: ${rulepriority}
    example: "Swap the first and third notes in measure 2"
    type: token
    pattern: |
      (@location:Location [tag=/,/])? (?<trigger>[word=/(?i)^(${switch_triggers})/])
      (@note:Note|@chord:Chord|@rest:Rest|@pitchsequence:PitchSequence) @location:Location?

  - name: switch-3-passive
    label: ${label}
    priority: ${rulepriority}
    example: "The first C and the first D in measure 2 should be switched"
    type: token
    pattern: |
      (@location:Location [tag=/,/])? @sourceEntity:EntityMusic and @destEntity:EntityMusic @location:Location?
      [word=/^(${modals})/] to? [word=/^(${aux_be})/] (?<trigger>[word=/(?i)^(${switch_triggers})/])
      @location:Location?

  # todo: how do we represent this in terms of source and destination entities?
  - name: switch-4-passive
    label: ${label}
    priority: ${rulepriority}
    example: "The first two chords should be switched in measure 1"
    type: token
    pattern: |
      (@location:Location [tag=/,/])? (@note:Note|@chord:Chord|@rest:Rest|@pitchsequence:PitchSequence)
      @location:Location? [word=/^(${modals})/] to? [word=/^(${aux_be})/]
      (?<trigger>[word=/(?i)^(${switch_triggers})/]) @location:Location?