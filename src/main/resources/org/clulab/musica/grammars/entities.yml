vars: org/clulab/musica/grammars/triggers.yml


rules:

## --------------------------------------------
              # Atomic things
## --------------------------------------------

    # jc edited -- added lower & higher
    - name: direction
      label: Direction
      priority: 1
      type: token  # surface rule
      pattern: |
        [word=/(up|down|lower|higher)/]

    # jc added
    - name: negator
      label: Negator
      priority: 1
      type: token  # surface rule
      pattern: |
        [word=/(?i)^(${negators})$/] longer?

    - name: cardinality
      label: Cardinality
      priority: 1
      type: token  # surface rule
      pattern: |
        [(tag=/CD/ | entity=/ORDINAL/) & word=/^(?!eighth)/]

    # jc added
    # for instances where 'second' etc are tagged as part of a date
    - name: cardinality-2
      label: Cardinality
      priority: 1
      type: token
      pattern: |
        [word=/(?i)${ordinals}/]

    - name: proportion
      label: Proportion
      priority: 1
      type: token  # surface rule
      pattern: |
        [word=/(?i)^(${proportions})/]

    # todo: determine if 'tone' is used as step in "raise x by a whole tone"
    - name: step-trigger  # handle cases like "3 half steps"
      label: Step
      priority: 2
      type: token  # surface rule
      pattern: |
        (@cardinality:Cardinality)? (@proportion: Proportion)? (?<trigger>[word=/^step/])

    - name: step-underspecified  # handle cases when 'step' is elided, like "up 3"
      label: Step
      priority: 2
      type: token  # surface rule
      pattern: |
        (?<= /(?i)^(up|down)$/) (@cardinality:Cardinality)

    # jc added
    # todo: fix -- works for ABCD and A-B-C-D but not A,B,C,D, A B C D, or A, B, C, D
    - name: pitch-for-seqs
      label: PitchSequence
      priority: 1
      type: token
      pattern:
        (?<trigger> [word=/((${notes})(,|-|\s)?){2,8}\.?/]) # should not need to be token-initial or final
      # (?<trigger> [word=/(${notes},?-?\s?)+\.?/])

    # jc added
    # works for A B C D, but not A,B,C,D
    - name: pitch-for-seqs-2
      label: PitchSequence
      priority: 2
      type: token
      pattern: |
        ([word=/^${notes}$/]){2,8}

    # todo: fix
    - name: pitch-1
      label: Pitch
      priority: 1
      type: token  # surface rule
      pattern: |   # replace with ${notes} var?
        [word=/^(${notes})[0-9]*s?\.?$/]
      # Note: the \. is to handle cases that don't tokenize correctly,
      # like "Delete the second G." Here, the period is included in the G token.

    - name: specifier-1
      label: Specifier
      priority: 2
      type: token  # surface rule
      pattern: |
        (?<quantifier>[tag=/^(DT|PDT)/]+) (@cardinality:Cardinality)?
        |
        (?<quantifier>[word=/(?i)^everything/])

    - name: beat-1
      label: Beat
      priority: 2
      type: token  # surface rule
      pattern: |
        (?<trigger>[word=/^beat/]) @cardinality:Cardinality

    # jc added
    - name: beat-2
      label: Beat
      priority: 3
      type: token # surface rule
      pattern: |
        @specifier:Specifier (?<trigger>[word=/^beat/])

    # jc edited
    - name: measure-1
      label: Measure
      priority: 2
      type: token  # surface rule
      pattern: |
        (?<trigger>[word=/^(measure|bar)/]) @cardinality:Cardinality
      #  (?<trigger>[word=/^measure/]) @cardinality:Cardinality

    # jc added
    - name: measure-2
      label: Measure
      priority: 3
      type: token # surface rule
      pattern: |
        @specifier:Specifier (?<trigger>[word=/^(measure|bar)/])

    # jc added
    - name: octave
      label: Octave
      priority: 2
      type: token # surface rule
      pattern: |
        (@cardinality:Cardinality)? (?<trigger>[word=/^octave/])

    # jc added -- does not pick up words from chords var
    - name: chord
      label: Chord
      example: "A minor chord"
      priority: 3
      type: token
      pattern: |
        (@specifier:Specifier)? ([word=/(?i)${chords}/])? (?<trigger>[word=/^chord/])

    # jc added
    # todo: fix
#    - name: chord-underspecified
#      label: Chord
#      example: "the minor fifth"
#      priority: 3
#      pattern: |
#        (@specifier:Specifier)? (?<trigger>[word=/(?i)${chords}/]) @cardinality:Cardinality


## --------------------------------------------
              # Composed Items
## --------------------------------------------

  # jc added
    - name: absolute-location-1
      label: Locationabs
      example: "Add a quarter rest at the start"
      priority: 3
      type: token
      pattern: |
        @specifier:Specifier? (?<trigger>[word=/^(start|end|begin)/]) (with)?

  # jc added
    - name: absolute-location-2
      label: Locationabs
      example: "Add a quarter rest to the start of the second measure"
      priority: 4
      type: token
      pattern: |
        @specifier:Specifier? (?<trigger>[word=/^(start|end|begin)/]) of @measure:Measure


## --------------------------------------------
              # Simple Events
## --------------------------------------------


    # no "type" so it's a syntax rule
    - name: note-1
      label: Note
      priority: 3
      pattern: |  # what is amod or compound?
        trigger = [word=/(?i)^note/]
        duration: Proportion? = >/(amod|compound)/
        pitch: Pitch? = >/(amod|compound)/
        specifier: Specifier? = >/^det/

    - name: note-2-underspecified
      label: Note
      priority: 3
      type: token
      pattern: |
        (@specifier:Specifier [word=/^(?!note).*/]{,2})? @pitch:Pitch


    # Syntax isn't always right... :)
    - name: note-3-surface
      label: Note
      example: "Transpose the C quarter note up 1 half step."
      priority: 3
      type: token
      pattern: |
        (@specifier:Specifier []{,2})? @pitch:Pitch? @duration:Proportion? (?<trigger> [word=/(?i)^note/])

    - name: note-4-surface
      label: Note
      example: "Transpose the C quarter note up 1 half step."
      priority: 3
      type: token
      pattern: |
        (@specifier:Specifier)? @pitch:Pitch? @duration:Proportion? (?<trigger> [word=/(?i)^note/])


    # jc added
    - name: rest-1
      label: Rest
      example: "Add an eighth rest"
      priority: 3
      type: token
      pattern: |
        (@specifier:Specifier)? @duration:Proportion? (?<trigger> [word=/(?i)^rest/])

    - name: onset-1
      label: Onset
      priority: 4
      type: token
      pattern: |  # what does []? indicate?
          ((@measure:Measure []?)? @beat:Beat |
          @measure:Measure ([]? @beat:Beat)? |
          (@beat:Beat []?)? @measure:Measure |
          @beat:Beat ([]? @measure:Measure)?)

    - name: onset-2
      label: Onset
      priority: 4
      type: token
      pattern: |
        @measure:Measure []? @beat:Beat |
        @beat:Beat []? @measure:Measure


    # jc added
    - name: sequence
      label: PitchSequence
      priority: 3
      type: token
      pattern: |
        (@specifier:Specifier)? (?<trigger> [word=/(?i)^(sequence|run)/])


    # jc added -- do we need this?
    - name: relative-location
      label: Locationrel
      priority: 5
      type: token # surface rule
      pattern: |
        (?<trigger>[word=/${loc-preps}/]) by? (@onset:Onset|@note:Note|it)
      #  (?<trigger>[word=/${loc-preps}/]) (((@note:Note|@rest:Rest) ((in|of) @measure:Measure)?)|it)
      # [word=/(after|before|between|above|below|followed by)/]

#    - name: insert-1
#      label: Insert
#      priority: 3
#      pattern: |  # what is amod or compound?
#        trigger = [word=/(?i)^note/]
#        duration: Duration? = >/(amod|compound)/
#        pitch: Pitch? = >/(amod|compound)/
#        specifier: Specifier? = >det
