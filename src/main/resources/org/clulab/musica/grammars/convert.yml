
vars: org/clulab/musica/grammars/triggers.yml


rules:

  # works for both active and passive
  - name: convert-note-0-syntax-that-is-in
    label: ${label}
    priority: ${rulepriority}
    example: "Change the quarter note that is in the first measure to a quarter rest"
    pattern:
      trigger = [word=/(?i)^(${change_duration_triggers})/]
      sourceEntity:Note = >/dobj|nsubjpass/
      sourceLocation:Location = >/dobj|nsubjpass/ <nsubj (>/nmod_in|nmod_at/)?
      destEntity:Rest? = (>dobj <nsubj (>/nmod_in|nmod_at/)?)? >/nmod_to|nmod_into/
      destEntity:Chord? = (>dobj <nsubj (>/nmod_in|nmod_at/)?)? >/nmod_to|nmod_into/
      destEntity:PitchSequence? = (>dobj <nsubj (>/nmod_in|nmod_at/)?)? >/nmod_to|nmod_into/

  # testing--deal with 3 notes
  # todo: can we use an action to say if there is a source entity, use that + the info
  # todo:   in musical entity, otherwise use the musical entity AS the source entity?
  - name: convert-note-x-test
    label: ${label}
    priority: ${rulepriority}
    type: token
    pattern: |
      (@location:Location [tag=/,/]?)? (?<trigger>[word=/(?i)^(${convert_triggers})/])
      @musicalEntity:Note @location:Location? (from @sourceEntity:Note)? (to|into)
      (@destEntity:Rest|@destEntity:Chord|@destEntity:PitchSequence)

  #CONVERT NOTE TO X
  - name: convert-note-1
    label: ${label}
    priority: ${rulepriority}
    example: "Convert the quarter note in measure 1 into a quarter rest"
    type: token
    pattern: |
      (?<trigger>[word=/(?i)^(${convert_triggers})/]) @sourceEntity:Note @location:Location? (into|to)
      (@destEntity:Rest|@destEntity:Chord|@destEntity:PitchSequence)

  - name: convert-note-1b-syntax
    label: ${label}
    priority: ${rulepriority}
    example: "Convert the quarter note in measure 1 into a quarter rest"
    pattern: |
      trigger = [word=/(?i)^(${convert_triggers})/]
      sourceEntity: Note = >dobj
      location: Location = >/nmod_in|nmod_at/
      destEntity: Rest? = >/nmod_into|nmod_to/
      destEntity: Chord? = >/nmod_into|nmod_to/
      destEntity: PitchSequence? = >/nmod_into|nmod_to/

  - name: convert-note-2b-syntax-passive
    label: ${label}
    priority: ${rulepriority}
    example: "Convert the quarter note in measure 1 into a quarter rest"
    pattern: |
      trigger = [word=/(?i)^(${convert_triggers})/]
      sourceEntity: Note = >nsubjpass
      location: Location = (>nsubjpass)? >/nmod_in|nmod_at/
      destEntity: Rest? = >/nmod_into|nmod_to/
      destEntity: Chord? = >/nmod_into|nmod_to/
      destEntity: PitchSequence? = >/nmod_into|nmod_to/

  - name: convert-note-2-conjunction
    label: ${label}
    priority: ${rulepriority}
    example: "convert the G in measure 1 to an augmented second and the F into a rest"
    type: token
    pattern: |
      (?<trigger>[word=/(?i)^(${convert_triggers})/]) []{2,10} and @sourceEntity:Note (to|into)
      (@destEntity:Rest|@destEntity:Chord|@destEntity:PitchSequence) @location:Location?

  - name: convert-note-3-passive
    label: ${label}
    priority: ${rulepriority}
    example: "the G in measure 1 should be converted into a quarter rest"
    type: token
    pattern: |
      (@location:Location [tag=/,/]?)? @sourceEntity:Note @location:Location? [word=/^(${modals})/]?
      to? [word=/^(${aux_be})/] (?<trigger>[word=/(?i)^(${convert_triggers})/])
      (to|into) (@destEntity:Rest|@destEntity:Chord|@destEntity:PitchSequence) @location:Location?

  # CONVERT REST TO X
  - name: convert-rest-1
    label: ${label}
    priority: ${rulepriority}
    example: "Convert the quarter note in measure 1 into a quarter rest"
    type: token
    pattern: |
      (?<trigger>[word=/(?i)^(${convert_triggers})/]) @sourceEntity:Rest
      @location:Location? (into|to) (@destEntity:Note|@destEntity:Chord|@destEntity:PitchSequence)

  - name: convert-rest-2-conjunction
    label: ${label}
    priority: ${rulepriority}
    example: "convert the G in measure 1 to an augmented second and the F into a rest"
    type: token
    pattern: |
      (?<trigger>[word=/(?i)^(${convert_triggers})/]) []{2,10} and @sourceEntity:Rest (to|into)
      (@destEntity:Note|@destEntity:Rest|@destEntity:Chord|@destEntity:PitchSequence) @location:Location?

  - name: convert-rest-3-passive
    label: ${label}
    priority: ${rulepriority}
    example: "the G in measure 1 should be converted into a quarter rest"
    type: token
    pattern: |
      @location:Location? @sourceEntity:Rest @location:Location? [word=/^(${modals})/]? to?
      [word=/^(${aux_be})/] (?<trigger>[word=/(?i)^(${convert_triggers})/])
      (to|into) (@note:Note|@chord:Chord|@pitchsequence:PitchSequence) @location:Location?

  # CONVERT CHORD TO X (can convert one chord to another type of chord)
  - name: convert-chord-1
    label: ${label}
    priority: ${rulepriority}
    example: "Convert the quarter note in measure 1 into a quarter rest"
    type: token
    pattern: |
      (?<trigger>[word=/(?i)^(${convert_triggers})/]) @sourceEntity:Chord @location:Location?
      (into|to) (@destEntity:Note|@destEntity:Rest|@destEntity:Chord|@destEntity:PitchSequence)

  - name: convert-chord-2-conjunction
    label: ${label}
    priority: ${rulepriority}
    example: "convert the G in measure 1 to an augmented second and the F into a rest"
    type: token
    pattern: |
      (?<trigger>[word=/(?i)^(${convert_triggers})/]) []{2,10} and @sourceEntity:Chord (to|into)
      (@destEntity:Note|@destEntity:Rest|@destEntity:Chord|@destEntity:PitchSequence) @location:Location?

  - name: convert-chord-3-passive
    label: ${label}
    priority: ${rulepriority}
    example: "the G in measure 1 should be converted into a quarter rest"
    type: token
    pattern: |
      @location:Location? @sourceEntity:Chord @location:Location? [word=/^(${modals})/]? to?
      [word=/^(${aux_be})/] (?<trigger>[word=/(?i)^(${convert_triggers})/]) (to|into)
      (@destEntity:Note|@destEntity:Rest|@destEntity:Chord|@destEntity:PitchSequence) @location:Location?