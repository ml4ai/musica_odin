
vars: org/clulab/musica/grammars/triggers.yml


rules:

   - name: transpose-5
     label: ${label}
     priority: ${rulepriority}
     example: "The first quarter note in measure 1 is transposed down 2 steps"
     type: token
     pattern: |
       @note:Note @location:Location? []? ([] and)?
       (?<trigger>[word=/(?i)^(${transpose_triggers})/]) (@direction:Direction)?  @step:Step?

  #  Note (should) (be) (VERB and) TRANS (Direction) (Step) (Onset) (from Note) (to Note) (location)
   - name: transpose-6
     label: ${label}
     priority: ${rulepriority}
     example: "the eighth note should move up two steps from an A to the C above"
     type: token
     pattern: |
       (@location:Location [tag=/,/]?)? @note:Note (should)? ([] and)?
       (?<trigger>[word=/(?i)^(${transpose_triggers})/])
       @direction:Direction? @step:Step? @location:Location? (from @note:Note)?
       (to @note:Note @location:Location?)?

   - name: transpose-7
     label: ${label}
     priority: ${rulepriority}
     example: "take the first whole note and move it down one step"
     type: token
     pattern: |
       (@location:Location [tag=/,/]?)? @note:Note @location:Location? (and)?
       (?<trigger>[word=/(?i)^(${transpose_triggers})/])
       it @direction:Direction? @step:Step? (from @note:Note)? (to @note:Note @location:Location?)?

   - name: transpose-8-passive
     label: ${label}
     priority: ${rulepriority}
     example: "The first quarter note in measure 1 is transposed down 2 steps"
     type: token
     pattern: |
       (@location:Location [tag=/,/]?)? @note:Note @location:Location? (should|could|can)?
       [word=/^(${aux_be})/] ([] and)?
       (?<trigger>[word=/(?i)^(${transpose_triggers})/]) (@direction:Direction)?  @step:Step?
       (to @note:Note)?

#  Note (should) (be) (VERB and) TRANS (Direction) (Step) (Onset) (from Note) (to Note) (location)
   - name: transpose-9-passive
     label: ${label}
     priority: ${rulepriority}
     example: "the eighth note should move up two steps from an A to the C above"
     type: token
     pattern: |
       (@location:Location [tag=/,/]?)? @note:Note (should)? [word=/^(${aux_be})/] ([] and)?
       (?<trigger>[word=/(?i)^(${transpose_triggers})/])
       @direction:Direction? @step:Step? @location:Location? (from @note:Note)?
       (to @note:Note @location:Location?)? @direction:Direction?


   - name: transpose-10-everything
     label: ${label}
     priority: ${rulepriority}
     example: "Transpose all the notes up 5 half steps in measure 1."
     type: token
     pattern: |
       (@location:Location [tag=/,/]?)? (?<trigger>[word=/(?i)^(${transpose_triggers})/])
       @everything:Everything @direction:Direction? @step:Step @location:Location?

   - name: transpose-11-everything-passive
     label: ${label}
     example: "Everything in measure 2 should be transposed up 1 half step"
     type: token
     pattern: |
       (@location:Location [tag=/,/]?)? @everything:Everything @location:Location? (should?) [word=/^(${aux_be})/]
       (?<trigger>[word=/(?i)^(${transpose_triggers})/]) @direction:Direction? @step:Step?

   # todo: EITHER choose transpose-12 or transpose-1 through -7 below
   - name: transpose-12-active-fuller
     label: ${label}
     example: "transpose the quarter note in measure 1 from an A to a C"
     type: token
     pattern: |
       (@location:Location [tag=/,/]?)? (?<trigger>[word=/(?i)^(${transpose_triggers})/])
       (@note:Note|@chord:Chord) @location:Location? @direction:Direction? @step:Step? @location:Location?
       (from (@note:Note|@pitch:Pitch|@chord:Chord))? (to (@note:Note|@pitch:Pitch|@chord:Chord))?
       (@direction:Direction (@step:Step)?)? @location:Location?

   # all of the following together cover the same amount as transpose-12?
   - name: transpose-1-basic
     label: ${label}
     example: "transpose the C quarter note in measure 2 up one step"
     type: token
     pattern: |
       (?<trigger>[word=/(?i)^(${transpose_triggers})/]) (@note:Note|@chord:Chord) @location:Location?
       @direction:Direction? @step:Step? (from (@note:Note|@pitch:Pitch|@chord:Chord))?
       (to (@note:Note|@pitch:Pitch|@chord:Chord))?

   - name: transpose-2-appositive-location
     label: ${label}
     example: "in measure 1, move the C up two steps to an E"
     type: token
     pattern: |
       (@location:Location [tag=/,/]?) (?<trigger>[word=/(?i)^(${transpose_triggers})/]) (@note:Note|@chord:Chord)
       @direction:Direction? @step:Step? (from (@note:Note|@pitch:Pitch|@chord:Chord))?
       (to (@note:Note|@pitch:Pitch|@chord:Chord))?

   - name: transpose-3-location-final
     label: ${label}
     example: "move the C up 3 semitones to a D sharp in beat 2 of measure 1"
     type: token
     pattern: |
       (?<trigger>[word=/(?i)^(${transpose_triggers})/]) (@note:Note|@chord:Chord) @direction:Direction? @step:Step?
       (from (@note:Note|@pitch:Pitch|@chord:Chord))? (to (@note:Note|@pitch:Pitch|@chord:Chord))?
       @location:Location?

   - name: transpose-4-direction-final
     label: ${label}
     example: "move the C in measure 1 to the G above it"
     type: token
     pattern: |
       (?<trigger>[word=/(?i)^(${transpose_triggers})/]) (@note:Note|@chord:Chord) @location:Location?
       (from (@note:Note|@pitch:Pitch|@chord:Chord))? (to (@note:Note|@pitch:Pitch|@chord:Chord))?
       (@direction:Direction @step:Step?)?

   - name: transpose-5-direction-and-location-final
     label: ${label}
     example: "move the C to the G above it in measure 1"
     type: token
     pattern: |
       (?<trigger>[word=/(?i)^(${transpose_triggers})/]) (@note:Note|@chord:Chord)
       (from (@note:Note|@pitch:Pitch|@chord:Chord))? (to (@note:Note|@pitch:Pitch|@chord:Chord))?
       (@direction:Direction @step:Step?)? @location:Location?

   - name: transpose-6-appositive-with-direction-final
     label: ${label}
     example: "in measure 1, move the C to the G above it"
     type: token
     pattern: |
       (@location:Location [tag=/,/]?) (?<trigger>[word=/(?i)^(${transpose_triggers})/]) (@note:Note|@chord:Chord)
       (from (@note:Note|@pitch:Pitch|@chord:Chord))? (to (@note:Note|@pitch:Pitch|@chord:Chord))?
       (@direction:Direction @step:Step?)?

   - name: transpose-7-dir-step-loc-sequence
     label: ${label}
     example: "transpose the first quarter note up two steps in measure one from an A to a C#"
     type: token
     pattern: |
       (?<trigger>[word=/(?i)^(${transpose_triggers})/]) (@note:Note|@chord:Chord)
       (@direction:Direction @step:Step?)? @location:Location?
       (from (@note:Note|@pitch:Pitch|@chord:Chord))? (to (@note:Note|@pitch:Pitch|@chord:Chord))?


#   # for when onset added to start as appositive
#   - name: Transpose-1-syntax
#     label: ${label}
#     priority: ${rulepriority}
#     pattern: |
#       trigger = [word=/(?i)^(${transpose_triggers})/]
#       location: Location? = >nmod_in
#       note: Note = >dobj
#       chord: Chord = >dobj
#       direction: Direction? = >/nmod_(up|down)/ >case
#       step: Step? = >/nmod_(up|down)/

#   - name: Transpose-2
#     label: ${label}
#     priority: ${rulepriority}
#     type: token
#     pattern: |
#       (@location:Location [tag=/,/]?)? @location:Location? (?<trigger>[word=/(?i)^(${transpose_triggers})/])
#       (@note:Note|@chord:Chord) @location:Location? @direction:Direction? @step:Step? @location:Location?

#   - name: Transpose-3
#     label: ${label}
#     priority: ${rulepriority}
#     example: "Transpose all the notes up 5 half steps in measure 1."
#     type: token
#     pattern: |
#       (?<trigger>[word=/(?i)^(${transpose_triggers})/]) (@note:Note|@chord:Chord)
#       @direction:Direction? @step:Step @location:Location?

#   # todo: add specificity to avoid things like 'change the whole note to a half note'
#   - name: Transpose-4
#     label: ${label}
#     priority: ${rulepriority}
#     example: "Move the G quarter note to the F above it"
#     type: token
#     pattern: |
#       (@location:Location [tag=/,/]?)? (?<trigger>[word=/(?i)^(${transpose_triggers})/])
#       (@note:Note|@chord:Chord) (@direction:Direction)? to (@note:Note|@pitch:Pitch|@chord:Chord)
#       @location:Location?