
vars: org/clulab/musica/grammars/triggers.yml


rules:

  #CONVERT NOTE TO X
  - name: convert-note-1
    label: ${label}
    priority: ${rulepriority}
    example: "Convert the quarter note in measure 1 into a quarter rest"
    type: token
    pattern: |
      (?<trigger>[word=/(?i)^(${convert_triggers})/]) @sourceEntity:Note @location:Location? (into|to)
      (@destEntity:Rest|@destEntity:Chord|@destEntity:PitchSequence)

  - name: convert-note-1b-syntax
    label: ${label}
    priority: ${rulepriority}
    example: "Convert the quarter note in measure 1 into a quarter rest"
    pattern: |
      trigger = [word=/(?i)^(${convert_triggers})/]
      sourceEntity: Note = >dobj
      location: Location = >/nmod_in|nmod_at/
      destEntity: Rest? = >/nmod_into|nmod_to/
      destEntity: Chord? = >/nmod_into|nmod_to/
      destEntity: PitchSequence? = >/nmod_into|nmod_to/

  - name: convert-note-2b-syntax-passive
    label: ${label}
    priority: ${rulepriority}
    example: "Convert the quarter note in measure 1 into a quarter rest"
    pattern: |
      trigger = [word=/(?i)^(${convert_triggers})/]
      sourceEntity: Note = >nsubjpass
      location: Location = (>nsubjpass)? >/nmod_in|nmod_at/
      destEntity: Rest? = >/nmod_into|nmod_to/
      destEntity: Chord? = >/nmod_into|nmod_to/
      destEntity: PitchSequence? = >/nmod_into|nmod_to/

#  - name: convert-note-1
#    label: ${label}
#    priority: ${rulepriority}
#    example: "Convert the quarter note in measure 1 into a quarter rest"
#    type: token
#    pattern: |
#      (@location:Location [tag=/,/]?)?
#      (?<trigger>[word=/(?i)^(${convert_triggers})/]) @note:Note location:Location? (into|to)
#      (@rest:Rest|@chord:Chord|@pitchsequence:PitchSequence) @location:Location?

  - name: convert-note-2-conjunction
    label: ${label}
    priority: ${rulepriority}
    example: "convert the G in measure 1 to an augmented second and the F into a rest"
    type: token
    pattern: |
      (?<trigger>[word=/(?i)^(${convert_triggers})/]) []{2,10} and @note:Note (to|into)
      (@rest:Rest|@chord:Chord|@pitchsequence:PitchSequence) @location:Location?

  - name: convert-note-3-passive
    label: ${label}
    priority: ${rulepriority}
    example: "the G in measure 1 should be converted into a quarter rest"
    type: token
    pattern: |
      (@location:Location [tag=/,/]?)? @note:Note @location:Location? should? [word=/^(${aux_be})/]
      (?<trigger>[word=/(?i)^(${convert_triggers})/])
      (to|into) (@rest:Rest|@chord:Chord|@pitchsequence:PitchSequence) @location:Location?

  # CONVERT REST TO X
  - name: convert-rest-1
    label: ${label}
    priority: ${rulepriority}
    example: "Convert the quarter note in measure 1 into a quarter rest"
    type: token
    pattern: |
      (?<trigger>[word=/(?i)^(${convert_triggers})/]) @rest:Rest
      @location:Location? (into|to) (@note:Note|@chord:Chord|@pitchsequence:PitchSequence)

  - name: convert-rest-2-conjunction
    label: ${label}
    priority: ${rulepriority}
    example: "convert the G in measure 1 to an augmented second and the F into a rest"
    type: token
    pattern: |
      (?<trigger>[word=/(?i)^(${convert_triggers})/]) []{2,10} and
      (@note:Note|@rest:Rest|@chord:Chord|@pitchsequence:PitchSequence) (to|into)
      (@note:Note|@rest:Rest|@chord:Chord|@pitchsequence:PitchSequence) @location:Location?

  - name: convert-rest-3-passive
    label: ${label}
    priority: ${rulepriority}
    example: "the G in measure 1 should be converted into a quarter rest"
    type: token
    pattern: |
      @location:Location? @rest:Rest
      @location:Location? should? [word=/^(${aux_be})/] (?<trigger>[word=/(?i)^(${convert_triggers})/])
      (to|into) (@note:Note|@chord:Chord|@pitchsequence:PitchSequence) @location:Location?

  # CONVERT CHORD TO REST
  # todo: Determine if changing from one chord type to another is a 'convert' event
  # currently written as though it is
  - name: convert-chord-1
    label: ${label}
    priority: ${rulepriority}
    example: "Convert the quarter note in measure 1 into a quarter rest"
    type: token
    pattern: |
      (?<trigger>[word=/(?i)^(${convert_triggers})/]) @chord:Chord
      @location:Location? (into|to) (@note:Note|@rest:Rest|@chord:Chord|@pitchsequence:PitchSequence)

  - name: convert-chord-2-conjunction
    label: ${label}
    priority: ${rulepriority}
    example: "convert the G in measure 1 to an augmented second and the F into a rest"
    type: token
    pattern: |
      (?<trigger>[word=/(?i)^(${convert_triggers})/]) []{2,10} and @chord:Chord (to|into)
      (@note:Note|@rest:Rest|@chord:Chord|@pitchsequence:PitchSequence) @location:Location?

  - name: convert-chord-3-passive
    label: ${label}
    priority: ${rulepriority}
    example: "the G in measure 1 should be converted into a quarter rest"
    type: token
    pattern: |
      @location:Location? @chord:Chord @location:Location? should? [word=/^(${aux_be})/]
      (?<trigger>[word=/(?i)^(${convert_triggers})/]) (to|into)
      (@note:Note|@rest:Rest|@chord:Chord|@pitchsequence:PitchSequence) @location:Location?